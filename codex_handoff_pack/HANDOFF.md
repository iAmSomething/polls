# HANDOFF — 9개 기관 가중 합성 여론(2025~) + 예측/업데이트 루프 + 이슈 반영 아이디어

작성일: 2026-02-16 (Asia/Seoul)

## 0. 목표
- “정확도↑ 클러스터” 9개 여론조사기관만 사용해, 과거 선거 기반 정확도(MAE)로 가중치를 부여한 **단일(합성) 정당지지도 시계열**을 구축한다.
- 기간: **2025-01-01 ~ 최근**
- 정당: **조사에 포함된 모든 정당 + 기타정당 + 무당층/무응답 포함**
- 최신치: 여심위(중앙선거여론조사심의위) 비공개 구간을 제외하고,
  **기관/의뢰자 공개자료(웹)에서 “정당별 전체 분해 수치”가 확보될 때만** 추가 반영한다.
- 예측: 합성 시계열을 주간화하여 **다음 주 월요일 지지율을 추정**하고,
  매주 월요일 실제(취합값)와 비교해 오차를 줄이는 방향으로 **가중치 업데이트**를 수행한다.
- 추가 아이디어: “주중 정치 이슈”를 입력받아 **이슈 충격(impact)**을 추정하여 예측에 반영하는 이벤트 모델로 확장한다.

---

## 1. 입력 데이터

### 1-1. 업로드 엑셀 원자료
- 파일: `전국단위 선거여론조사결과의 주요 데이터(2023.10.30.~).xlsx`
- (현 세션 컨테이너 경로 예시)
  - `/mnt/data/전국단위+선거여론조사결과의+주요+데이터(2023.10.30.~).xlsx`

### 1-2. 사용 시트
- 2025년: `정당지지도 (25.1.1~12.31.)`
- 2026년: `정당지지도 (26.1.1~)`

> **중요(구조 차이):** 2025~2026 시트에서는 `정당지지율(%)` 컬럼이 사실상 **더불어민주당 값**으로 들어가 있어,
> 전처리에서 `정당지지율(%) -> 더불어민주당` rename이 필요.

---

## 2. 대상 기관(정확도↑ 클러스터 9개)

다음 9개 기관만 사용:

- 리서치앤리서치
- 엠브레인퍼블릭
- 리서치뷰
- 에이스리서치
- 한국리서치
- 조원씨앤아이
- 알앤써치
- 리얼미터
- 코리아리서치인터내셔널

```python
POLLSTERS = [
  "리서치앤리서치","엠브레인퍼블릭","리서치뷰","에이스리서치",
  "한국리서치","조원씨앤아이","알앤써치","리얼미터","코리아리서치인터내셔널"
]
```

---

## 3. 전처리 규칙

### 3-1. 헤더(정당명) 처리
- 엑셀을 `header=0`로 읽은 후,
- 첫 행(`raw.iloc[0]`)을 “정당명 헤더”로 사용해 컬럼명을 재구성.
- 2025~2026 시트에서는 `정당지지율(%)` 컬럼이 실제로 민주당 값이므로 rename:
  - `정당지지율(%)` → `더불어민주당`

### 3-2. 날짜 파싱
`조사일자` 예: `25.01.02.~03.` 또는 `25.01.02~03.` 등

- 시작/종료일 파싱 후
- 기본 시계열 축은 `date_end`(조사 종료일)
- 옵션으로 `date_mid`(중앙일)도 유지

---

## 4. 합성(단일) 시계열 생성

### 4-1. “정확도 가중치” 정의
- 기관별 정확도 지표(선거결과 대비 MAE)를 사용해:
  - `weight_i = 1 / MAE_i`
  - 전체 합이 1이 되도록 정규화
- MAE 파일이 없거나 일부 기관이 누락되면 equal weight fallback

### 4-2. 날짜 단위 집계
- 그룹 키: `date_end`
- 날짜별로 존재하는 기관만 사용하여 정당별 가중 평균 산출
- 특정 정당 값이 기관에서 누락이면 결측 무시(그 정당 평균 계산에서 제외)

수식(정당 p, 날짜 t):
```
blend[t,p] = sum_i w_i * value[t,i,p] / sum_i w_i   (값이 존재하는 i만)
```

---

## 5. 생성된 산출물(현 세션)

### 5-1. 단일 합성 시계열(정당 전체 포함, 2025~최근)
- 그래프(PNG): `weighted_poll_9_agencies_all_parties_2025_present.png`
- 데이터(XLSX): `weighted_poll_9_agencies_all_parties_2025_present.xlsx`
  - `weighted_time_series`: date_end별 합성치
  - `weights`: 9개 기관 가중치
  - `party_labels`: 표시 라벨

### 5-2. 다음 주(2026-02-23) 주간 예측
- 그래프(PNG): `weighted_poll_forecast_next_week.png`
- 데이터(XLSX): `weighted_poll_forecast_next_week.xlsx`
  - `forecast`: 항목별 예측치 + 불확실성(RMSE)
  - `weekly_series`: 월요일 기준 주간화 시계열

---

## 6. “웹 최신치” 반영 규칙(현재 합의)

### 6-1. 포함 조건
- 여심위 비공개 구간은 제외.
- 기관/의뢰자 공개자료에서 **정당별 전체 분해 수치가 ‘텍스트로’ 확인 가능**할 때만 추가.
- 이미지/표/PDF만 제공되는 경우는 파싱 비용이 크므로 기본 제외(추후 확장 가능).

### 6-2. 현 세션에서 추가 반영한 웹 포인트(예시)
- 리얼미터(2026-02-12~13) 1건을 “부분 정당 분해”로 추가:
  - 민주 44.8, 국힘 36.1, 조국혁신당 3.8, 개혁신당 2.7, 진보당 1.5, 기타 2.0, 무당 9.2
  - 출처: Newsis 기사(링크는 본 세션 대화에 존재)

---

## 7. 예측(“학습”) 모델 — 현재 구현

### 7-1. 주간화
- date_end 시계열을 일별로 reindex + time interpolation
- 월요일 기준으로 재샘플링: `freq='W-MON'`

### 7-2. 1주 вперед 예측(정당별)
- 최근 N주(기본 16주) window
- 선형 추세 least squares
- 기울기(slope)를 0.5로 감쇠(damping)해 과도한 외삽 방지
- 불확실성: 잔차 RMSE

### 7-3. 예측 결과(참고: 2026-02-23)
- 더불어민주당: 44.33
- 국민의힘: 36.73
- 조국혁신당: 2.84
- 개혁신당: 2.86
- 진보당: 1.43
- 기타정당: 2.21
- 지지정당 없음: 8.67
- 모름/무응답: 1.01

---

## 8. “오차 줄이기” 주간 업데이트 루프(운영 플로우)

매주 월요일:

1) 웹에서 9개 기관의 최신 ‘정당지지도’ 공개자료를 수집  
   - 조건: 정당별 전체 분해 수치가 텍스트로 확보되는 경우만  
2) 확보된 데이터로 합성치 업데이트(이번 주 “실측” 역할)  
3) 지난주 예측과 비교해 오차 계산  
4) 가중치 업데이트(제약: w_i>=0, sum(w)=1)  
   - 손실: MAE 또는 Huber loss 추천(이상치 강건)  
   - 기간: 최근 8~12주 rolling window 추천  
5) 다음주 예측 재산출  

---

## 9. 이슈 반영(event shock) 확장 아이디어

### 9-1. 목적
주중 정치 이슈를 입력받아 “이슈 충격”을 추정해 예측에 반영.

```
next_support = baseline_forecast + Σ (impact_coeff[issue_type, party] * intensity)
```

### 9-2. 이슈 입력 스키마(제안)
- issue_date: YYYY-MM-DD
- issue_type: {경제, 안보, 사법, 인사, 부패/비리, 정책성과, 사고/참사, ...}
- intensity: 0~3
- direction(optional): {민주 유리/불리, 국힘 유리/불리, 중립}
- persistence(optional): {즉시, 지연, 잔존/감쇠}

### 9-3. 학습(온라인)
- 주간 오차를 보고 impact_coeff 업데이트
- 과적합 방지: L2 정규화 + 계수 감쇠
- 지연효과: lag(week0, week+1) feature 가능

---

## 10. 다음 액션(우선순위)
1) 9개 기관 웹 수집 파이프라인 구축(“정당별 전체 수치 텍스트”만)  
2) 주간 실행 스크립트 + 로그/리포트 자동 생성  
3) 이슈 입력 스키마 확정 + 학습 루프 결합  
4) 가중치 업데이트 최적화(비음수 제약 + 합=1)  

끝.
